{% extends "main/base.html" %}
{% block title %}–ü–æ–∏—Å–∫ —Ä–µ—Ü–µ–ø—Ç–æ–≤ - –ö—É–ª–∏–Ω–∞—Ä–Ω–∞—è –∫–Ω–∏–≥–∞{% endblock %}

{% block page_title %}
  <h1>üîç –ü–æ–∏—Å–∫ —Ä–µ—Ü–µ–ø—Ç–æ–≤</h1>
{% endblock %}

{% block content %}
  
  <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
  {% include 'search/search_form.html' %}

  <!-- –ü–ê–ì–ò–ù–ê–¶–ò–Ø –°–í–ï–†–•–£ -->
  {% include 'search/pagination.html' %}

  {% if query %}
    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞: "{{ query }}"</h2>
  {% else %}
    <h2>–í—Å–µ —Ä–µ—Ü–µ–ø—Ç—ã</h2>
  {% endif %}

  {% if recipes %}
    <div class="recipe-grid">
      {% for recipe in recipes %}
        <div class="recipe-card">
          <h3 class="recipe-title">
            <a href="{% url 'search_detail' recipe.id %}">{{ recipe.title }}</a>
          </h3>
          
          
          <div class="recipe-meta">
            <p><strong>üë§ –ê–≤—Ç–æ—Ä:</strong> {{ recipe.author.username }}</p>
            <p><strong>üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> {{ recipe.category.name|default:"–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏" }}</p>
            <p><strong>‚ö° –°–ª–æ–∂–Ω–æ—Å—Ç—å:</strong> {{ recipe.get_difficulty_display }}</p>
            <p><strong>‚≠ê –†–µ–π—Ç–∏–Ω–≥:</strong> {{ recipe.rating }}</p>
            <p><strong>‚è±Ô∏è –í—Ä–µ–º—è:</strong> {{ recipe.cook_time }} –º–∏–Ω</p>
          </div>
          
          {% if recipe.description %}
            <p class="recipe-description">
              {{ recipe.description|truncatewords:20 }}
            </p>
          {% endif %}
          
          {% if request.user.is_authenticated %}
            <div class="recipe-actions">
              <a href="{% url 'search_detail' recipe.id %}" class="btn btn-primary">üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä</a>
              <div class="collection-quick-add">
                <button class="btn btn-success" onclick="showCollectionModal({{ recipe.id }})">
                  ‚ûï –í –∫–æ–ª–ª–µ–∫—Ü–∏—é
                </button>
              </div>
            </div>
          {% else %}
            <div class="recipe-actions">
              <a href="{% url 'search_detail' recipe.id %}" class="btn btn-primary">üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä</a>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    <!-- –ü–ê–ì–ò–ù–ê–¶–ò–Ø –°–ù–ò–ó–£ -->
    {% include 'search/pagination.html' %}

  {% else %}
    {% if query %}
      <p style="color: #666; font-style: italic;">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ –∑–∞–ø—Ä–æ—Å—É "{{ query }}"</p>
    {% else %}
      <p style="color: #666; font-style: italic;">–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ—Ü–µ–ø—Ç–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö</p>
    {% endif %}
  {% endif %}

  <hr>
  <div style="display: flex; gap: 15px; margin-top: 20px;">
    <a href="{% url 'search' %}" style="color: #666; text-decoration: none;">‚Üê –ù–∞–∑–∞–¥ –∫ –ø–æ–∏—Å–∫—É</a>
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é -->
  {% if request.user.is_authenticated %}
    <div id="collectionModal" class="modal" style="display: none;">
      <div class="modal-content">
        <span class="close" onclick="hideCollectionModal()">&times;</span>
        <h3>üìö –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é</h3>
        <div id="modalRecipeInfo"></div>
        <div id="modalCollections"></div>
      </div>
    </div>
  {% endif %}

  <script>
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —Ñ–æ–Ω
    document.getElementById('collectionModal').addEventListener('click', function(e) {
      if (e.target === this) {
        hideCollectionModal();
      }
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ Escape
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        hideCollectionModal();
      }
    });
  </script>
{% endblock %}