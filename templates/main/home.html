{% extends "main/base.html" %}

{% block title %}–ì–ª–∞–≤–Ω–∞—è - –ö—É–ª–∏–Ω–∞—Ä–Ω–∞—è –∫–Ω–∏–≥–∞{% endblock %}

{% block page_title %}
  <div class="text-center mb-5">
    <h1 class="display-3 text-primary">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
    <p class="lead">–î–µ–ª–∏—Ç–µ—Å—å –ª—é–±–∏–º—ã–º–∏ —Ä–µ—Ü–µ–ø—Ç–∞–º–∏ –∏ –Ω–∞—Ö–æ–¥–∏—Ç–µ –Ω–æ–≤—ã–µ –∏–¥–µ–∏</p>
  </div>
{% endblock %}

{% block content %}

  <!-- –§–∏–ª—å—Ç—Ä —Ä–µ—Ü–µ–ø—Ç–æ–≤ -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <h4 class="card-title mb-0">
        <i class="fas fa-filter me-2"></i>–§–∏–ª—å—Ç—Ä —Ä–µ—Ü–µ–ø—Ç–æ–≤
      </h4>
    </div>
    <div class="card-body">
      <form id="filter-form">
        <div class="row g-3">
          <div class="col-md-4">
            <label for="ingredient-filter" class="form-label">–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç</label>
            <input type="text" id="ingredient-filter" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–∞">
          </div>
          <div class="col-md-4">
            <label for="difficulty-filter" class="form-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å</label>
            <select id="difficulty-filter" class="form-select">
              <option value="">–õ—é–±–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å</option>
              <option value="easy">–õ–µ–≥–∫–æ</option>
              <option value="medium">–°—Ä–µ–¥–Ω–µ</option>
              <option value="hard">–°–ª–æ–∂–Ω–æ</option>
            </select>
          </div>
          <div class="col-md-4">
            <label for="category-filter" class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select id="category-filter" class="form-select">
              <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
              {% for cat in categories %}
                <option value="{{ cat.slug }}">{{ cat.name }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="row mt-3">
          <div class="col-12 text-center">
            <button type="button" id="apply-filter" class="btn btn-primary me-2">
              <i class="fas fa-filter me-1"></i>–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä
            </button>
            <button type="button" id="clear-filter" class="btn btn-outline-secondary">
              <i class="fas fa-times me-1"></i>–°–±—Ä–æ—Å–∏—Ç—å
            </button>
          </div>
        </div>
      </form>
    </div>
  </div>

  <!-- –°–≤–µ–∂–∏–µ —Ä–µ—Ü–µ–ø—Ç—ã -->
  <div class="row mb-4">
    <div class="col-12">
      <h2 class="mb-4">
        <i class="fas fa-fire me-2 text-danger"></i>–°–≤–µ–∂–∏–µ —Ä–µ—Ü–µ–ø—Ç—ã
      </h2>
    </div>
  </div>
  
  <!-- –î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç -->
  <div class="text-center mb-4">
    {% if user.is_authenticated %}
      <a href="{% url 'recipe_add' %}" class="btn btn-success btn-lg">
        <i class="fas fa-plus me-2"></i>–î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç
      </a>
    {% else %}
      <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>
        <a href="{% url 'users:login' %}" class="alert-link">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç
      </div>
    {% endif %}
  </div>

  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–µ—Ü–µ–ø—Ç–æ–≤ -->
  <div id="recipes-container">
    {% if recipes %}
      <div class="row">
    {% for recipe in recipes %}
          <div class="col-lg-6 col-md-6 mb-4">
            <div class="card h-100" style="border-radius: 20px; border: none; box-shadow: 0 2px 10px rgba(0,0,0,0.08); background: white; height: 350px;">
              <div class="card-header" style="background: linear-gradient(135deg, #6f42c1, #007bff); height: 6px; border-radius: 20px 20px 0 0; padding: 0;"></div>
              
              <div class="card-body d-flex flex-column" style="padding: 25px; height: 100%;">
                <h5 class="card-title mb-3" style="font-size: 1.3rem; font-weight: 700; color: #2c3e50; line-height: 1.3;">
                  <a href="{% url 'recipe_detail' recipe.pk %}" class="text-decoration-none text-dark">
                    {{ recipe.title }}
                  </a>
                </h5>
                
                <!-- –î–µ—Ç–∞–ª–∏ —Ä–µ—Ü–µ–ø—Ç–∞ -->
                <div class="mb-3">
                  <div class="row g-2 mb-2">
                    <div class="col-4">
                      <span class="badge" style="background: #f8f9fa; color: #495057; border-radius: 25px; padding: 6px 10px; font-size: 0.75rem; font-weight: 500;">
                        <i class="fas fa-user me-1" style="color: #6c757d;"></i>–ê–≤—Ç–æ—Ä: {{ recipe.author.username }}
                      </span>
                    </div>
                    {% if recipe.category %}
                    <div class="col-4">
                      <span class="badge" style="background: #f8f9fa; color: #495057; border-radius: 25px; padding: 6px 10px; font-size: 0.75rem; font-weight: 500;">
                        <i class="fas fa-folder me-1" style="color: #6c757d;"></i>–ö–∞—Ç–µ–≥–æ—Ä–∏—è: {{ recipe.category.name }}
                      </span>
                    </div>
                    {% endif %}
                    <div class="col-4">
                      <span class="badge" style="background: #f8f9fa; color: #495057; border-radius: 25px; padding: 6px 10px; font-size: 0.75rem; font-weight: 500;">
                        <i class="fas fa-bolt me-1" style="color: #6c757d;"></i>–°–ª–æ–∂–Ω–æ—Å—Ç—å: {{ recipe.get_difficulty_display }}
                      </span>
                    </div>
                  </div>
                  <div class="row g-2">
                    <div class="col-6">
                      <span class="badge" style="background: #f8f9fa; color: #495057; border-radius: 25px; padding: 6px 10px; font-size: 0.75rem; font-weight: 500;">
                        <i class="fas fa-star me-1" style="color: #ffc107;"></i>–†–µ–π—Ç–∏–Ω–≥: {{ recipe.rating|floatformat:1 }}
                      </span>
                    </div>
                    <div class="col-6">
                      <span class="badge" style="background: #f8f9fa; color: #495057; border-radius: 25px; padding: 6px 10px; font-size: 0.75rem; font-weight: 500;">
                        <i class="fas fa-clock me-1" style="color: #6c757d;"></i>–í—Ä–µ–º—è: {{ recipe.cook_time }} –º–∏–Ω
                      </span>
                    </div>
                  </div>
                </div>
                
                {% if recipe.description %}
                  <p class="card-text text-muted flex-grow-1 mb-3" style="font-size: 0.9rem; line-height: 1.5; color: #6c757d;">
                    {{ recipe.description|truncatewords:25 }}
                  </p>
                {% endif %}
                
                <div class="mt-auto">
                  <div class="d-flex gap-2">
                    <a href="{% url 'recipe_detail' recipe.pk %}" class="btn flex-fill" style="background: linear-gradient(135deg, #6f42c1, #5a32a3); border: none; border-radius: 25px; padding: 12px 20px; color: white; font-weight: 600; text-decoration: none; transition: all 0.3s ease;">
                      <i class="fas fa-eye me-1"></i>–ü—Ä–æ—Å–º–æ—Ç—Ä
                    </a>
                    {% if user.is_authenticated %}
                      <button class="btn flex-fill" onclick="showCollectionModal({{ recipe.pk }})" style="background: linear-gradient(135deg, #28a745, #20c997); border: none; border-radius: 25px; padding: 12px 20px; color: white; font-weight: 600; transition: all 0.3s ease;">
                        <i class="fas fa-plus me-1"></i>–í –∫–æ–ª–ª–µ–∫—Ü–∏—é
                      </button>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>
    {% endfor %}
      </div>
    {% else %}
      <div class="text-center py-5">
        <i class="fas fa-utensils fa-4x text-muted mb-3"></i>
        <h4 class="text-muted">–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ—Ü–µ–ø—Ç–æ–≤</h4>
        <p class="text-muted">–°—Ç–∞–Ω—å—Ç–µ –ø–µ—Ä–≤—ã–º, –∫—Ç–æ –¥–æ–±–∞–≤–∏—Ç —Ä–µ—Ü–µ–ø—Ç!</p>
      </div>
    {% endif %}
  </div>

  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é -->
  {% if user.is_authenticated %}
    <div id="collectionModal" class="modal" style="display: none;">
      <div class="modal-content">
        <span class="close" onclick="hideCollectionModal()">&times;</span>
        <h3>üìö –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é</h3>
        <div id="modalRecipeInfo"></div>
        <div id="modalCollections"></div>
      </div>
    </div>
  {% endif %}
{% endblock %}
