{% extends "main/base.html" %}
{% block content %}
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–µ—Ü–µ–ø—Ç–∞ -->
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="display-4 text-primary">{{ recipe.title }}</h1>
      <div class="d-flex align-items-center justify-content-between mb-3">
        <div class="d-flex align-items-center">
          <span class="badge bg-secondary me-2">
            <i class="fas fa-user me-1"></i>{{ recipe.author }}
          </span>
          <span class="badge bg-info me-2">
            <i class="fas fa-clock me-1"></i>{{ recipe.cook_time }} –º–∏–Ω
          </span>
          <span class="badge bg-warning me-2">
            <i class="fas fa-star me-1"></i>{{ recipe.rating|floatformat:1 }}
          </span>
          {% if recipe.category %}
            <span class="badge bg-success">
              <i class="fas fa-tag me-1"></i>{{ recipe.category }}
            </span>
          {% endif %}
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∞–≤—Ç–æ—Ä–∞ -->
        {% if user.is_authenticated and user == recipe.author %}
          <div class="btn-group" role="group">
            <a href="{% url 'recipe_edit' recipe.pk %}" class="btn btn-outline-primary btn-sm">
              <i class="fas fa-edit me-1"></i>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
            </a>
            <a href="{% url 'recipe_delete' recipe.pk %}" class="btn btn-outline-danger btn-sm" 
               onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ä–µ—Ü–µ–ø—Ç?')">
              <i class="fas fa-trash me-1"></i>–£–¥–∞–ª–∏—Ç—å
            </a>
            <a href="{% url 'collection_list' %}" class="btn btn-outline-info btn-sm">
              <i class="fas fa-cog me-1"></i>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>


  <div class="row">
    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="col-lg-8">
      <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
  {% if recipe.images.exists %}
        <div class="card mb-4">
          <div class="card-header">
            <h5 class="card-title mb-0">
              <i class="fas fa-images me-2"></i>–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
    {% for img in recipe.images.all %}
                <div class="col-md-4 mb-3">
                  <img src="{{ img.image.url }}" alt="{{ recipe.title }}" class="img-fluid rounded">
                </div>
    {% endfor %}
            </div>
          </div>
        </div>
  {% endif %}

      <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-info-circle me-2"></i>–û–ø–∏—Å–∞–Ω–∏–µ
          </h5>
        </div>
        <div class="card-body">
          <p class="lead">{{ recipe.description }}</p>
        </div>
      </div>

      <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-list-ol me-2"></i>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è
          </h5>
        </div>
        <div class="card-body">
          <p>{{ recipe.instruction }}</p>
        </div>
      </div>

      <!-- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-comments me-2"></i>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
          </h5>
        </div>
        <div class="card-body">
          {% for comment in comments %}
            <div class="border-bottom pb-3 mb-3">
              <div class="d-flex justify-content-between align-items-start">
                <strong>{{ comment.user }}</strong>
                <small class="text-muted">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
              </div>
              <p class="mt-2 mb-0">{{ comment.text }}</p>
            </div>
    {% empty %}
            <p class="text-muted">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
    {% endfor %}
        </div>
      </div>
    </div>

    <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
    <div class="col-lg-4">
      <!-- –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-shopping-basket me-2"></i>–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã
          </h5>
        </div>
        <div class="card-body">
          {% for ri in recipe.recipe_ingredients.all %}
            <div class="d-flex justify-content-between align-items-center border-bottom py-2">
              <span>{{ ri.ingredient.name }}</span>
              <span class="badge bg-light text-dark">{{ ri.amount }} {{ ri.unit }}</span>
            </div>
    {% empty %}
            <p class="text-muted">–ù–µ—Ç –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤.</p>
    {% endfor %}
        </div>
      </div>

      <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ—Ü–µ–ø—Ç–µ -->
      <div class="card mb-4">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="fas fa-info me-2"></i>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
          </h5>
        </div>
        <div class="card-body">
          <div class="row text-center">
            <div class="col-6">
              <div class="border-end">
                <h6 class="text-muted">–°–ª–æ–∂–Ω–æ—Å—Ç—å</h6>
                <span class="badge bg-{% if recipe.difficulty == 'easy' %}success{% elif recipe.difficulty == 'medium' %}warning{% else %}danger{% endif %}">
                  {{ recipe.get_difficulty_display }}
                </span>
              </div>
            </div>
            <div class="col-6">
              <h6 class="text-muted">–í—Ä–µ–º—è</h6>
              <strong>{{ recipe.cook_time }} –º–∏–Ω</strong>
            </div>
        </div>
      </div>

      <!-- –§–æ—Ä–º—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->
      <div class="recipe-forms">
        {% if user.is_authenticated %}
          <!-- –§–æ—Ä–º–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è -->
          <div class="form-container">
            <h3 style="margin-bottom: 20px; color: #343a40;">üí¨ –û—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π</h3>
            <form method="post">
              {% csrf_token %}
              <div class="form-group">
                <label for="{{ comment_form.text.id_for_label }}">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
                {{ comment_form.text }}
              </div>
              <div class="form-buttons">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-paper-plane"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                </button>
              </div>
            </form>
          </div>

          <!-- –§–æ—Ä–º–∞ –æ—Ü–µ–Ω–∫–∏ -->
          <div class="form-container">
            <h3 style="margin-bottom: 20px; color: #343a40;">‚≠ê –ü–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É</h3>
            <form method="post">
              {% csrf_token %}
              <div class="form-group">
                <label for="{{ rating_form.value.id_for_label }}">–û—Ü–µ–Ω–∫–∞ (1-5):</label>
                {{ rating_form.value }}
                <div style="color: #6c757d; font-size: 0.875rem; margin-top: 5px;">–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 5</div>
              </div>
              <div class="form-buttons">
                <button type="submit" class="btn btn-success">
                  <i class="fas fa-star"></i> –û—Ü–µ–Ω–∏—Ç—å
                </button>
              </div>
            </form>
          </div>
        {% else %}
          <div class="alert alert-info text-center">
            <i class="fas fa-info-circle me-2"></i>
            <a href="{% url 'users:login' %}" class="alert-link">–í–æ–π–¥–∏—Ç–µ</a>, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∏–ª–∏ –æ—Ü–µ–Ω–∫—É.
          </div>
        {% endif %}
      </div>
    </div>
  </div>


{% endblock %}